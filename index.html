<!DOCTYPE html>
<html>

<head>
  <title>Page Title</title>
  <style>
    /* Add some basic styling for the loader */
    .loader {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 4px solid #ccc;
      border-top: 4px solid #1DB954;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
  <div style="display: flex; align-items: center; justify-content: center; height: 100vh;">
    <div class="loader"></div>
    <span style="margin-left: 10px;">Loading Spotify...</span>
  </div>

  <!-- Invisible button to trigger the auto-click -->
  <button id="hiddenButton" style="display: none;"></button>

  <script>
    // Define the function to update the button link and redirect to Spotify
    function redirectToSpotify() {
      // Make a request to the JSON link
      fetch("https://api.radioking.io/widget/radio/satvrno/track/current")
        .then((response) => response.json())
        .then((data) => {
          // Get the song name from the JSON
          const songName = `${data.title} ${data.artist}`;

          // Replace spaces with "%20"
          const encodedSongName = encodeURIComponent(songName);

          // Construct the Spotify search link
          const spotifySearchLink = `https://open.spotify.com/search/${encodedSongName}`;

          // Set the hidden button's href to the Spotify link
          const hiddenButton = document.getElementById("hiddenButton");
          hiddenButton.href = spotifySearchLink;

          // Auto-click the hidden button
          hiddenButton.click();
        })
        .catch((error) => {
          console.error("Error getting current song: ", error);
        });
    }

    // Call the function to redirect to Spotify when the document is ready
    $(document).ready(function() {
      redirectToSpotify();
    });
  </script>
</body>

</html>
